---
layout: post
title: "没[rails] redirect_to + XHR(XMLHttpRequest) でGET以外のメソッドが使われちゃうよ～"
date: 2014-04-03T06:30:00-07:00
comments: false
categories:
 - Ruby on Rails
---

<div class='post'>
 <a href="http://api.rubyonrails.org/classes/ActionController/Redirecting.html">ここ</a>曰く、そういうときもあるらしい。 <br>色々汚いもんが混ざってるけど、こんなコード書いたら、update失敗したときに、PUTでindexに戻ろうとして、routeねーよ、って怒られた。 <br><pre class="prettyprint"><span style="font-size: small;"><br />def update<br />  @project = Project.find(params[:id])<br /><br />  if params[:name] == "project_name"<br />    project_name = params[:value]<br />    @project.project_name = project_name<br />  end<br /><br />  respond_to do |format|<br />    if @project.update_attributes(params[:project])<br />      logMessage = self.class.to_s + "#" + __method__.to_s<br />      logger.info "######################aaaaaaaaaaaaaaaaaaaaaaaaaa\n"<br /><br />      @projects = Project.all<br />      format.html {<br />        flash.now[:notice] = 'Project was successfully updated.'<br />        render :action => "index"<br />      }<br />      format.json { head :no_content }<br />    else<br />      #logMessage = self.class.to_s + "#" + __method__.to_s<br />      logger.info "########################################\n"<br /><br />      flash.now[:error] = []<br />      flash.now[:error] = flash[:error] + @project.errors.full_messages if not @project.errors.empty?<br />      format.html {<br />        <font color="red">redirect_to action: "index"</font><br />      }<br />      format.json { render json: @project.errors, status: :unprocessable_entity }<br />    end<br />  end<br />end<br /></span></pre> ↑のほうに書いたサイトにならって、  <pre class="prettyprint"><span style="font-size: small;"><br />def update<br />  @project = Project.find(params[:id])<br /><br />  if params[:name] == "project_name"<br />    project_name = params[:value]<br />    @project.project_name = project_name<br />  end<br /><br />  respond_to do |format|<br />    if @project.update_attributes(params[:project])<br />      logMessage = self.class.to_s + "#" + __method__.to_s<br />      logger.info "######################aaaaaaaaaaaaaaaaaaaaaaaaaa\n"<br /><br />      @projects = Project.all<br />      format.html {<br />        flash.now[:notice] = 'Project was successfully updated.'<br />        render :action => "index"<br />      }<br />      format.json { head :no_content }<br />    else<br />      #logMessage = self.class.to_s + "#" + __method__.to_s<br />      logger.info "########################################\n"<br /><br />      flash.now[:error] = []<br />      flash.now[:error] = flash[:error] + @project.errors.full_messages if not @project.errors.empty?<br />      format.html {<br />        <red>redirect_to action: "index", status: 303</red><br />      }<br />      format.json { render json: @project.errors, status: :unprocessable_entity }<br />    end<br />  end<br />end<br /></span></pre>  修正。</div>
