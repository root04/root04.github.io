---
layout: post
title: "etckeeper howto"
date: 2012-06-08T00:45:00-07:00
comments: false
categories:
 - tools
---
<div  class=post>
  I used etckeeper to backup and version control my files under /etc.  <br> <br>
  # in precise pangolin <br> <br>
  install <br>
  $ sudo apt-get install etckeeper <br> <br>
  edit config file to use git(default uses bzr) <br>
  $ sudo vi /etc/etckeeper/etckeeper.conf <br> <br>
  before edit <br> <br>
  # The VCS to use.  <br>
  #VCS="hg" <br>
  #VCS="git"   <--- uncomment this line <br>
  VCS="bzr"     <--- comment out this line <br>
  #VCS="darcs" <br> <br>
  after edit <br> <br>
  # The VCS to use.
  #VCS="hg" <br>
  VCS="git"   <--- uncomment this line <br>
  #VCS="bzr"     <--- comment out this line <br>
  #VCS="darcs" <br>
  initialize repository <br>
  $ sudo etckeeper init <br>
    this creates and initializes git repository in /etc.  <br>
    it also adds the files in /etc to the staging, so if you want to <br>
    exclude any files to be managed, you should follow the following <br>
    instructions.  <br>
    remove files in staging <br>
    $ cd /etc <br>
    $ sudo git rm --cached -r -f ./ <br>
    I'm going to use gitignore, and gitignore ignores a file only if its not in the staging.  <br>
    thats why I removed them.  <br>
    edit .gitignore(its already gonna be there, generated by etckeeper) <br>
    $ cd /etc <br>
    $ sudo vi .gitignore <br>
    what I will do in the ignore file is <br>
    - ignore all files <br>
    - explicitly point out files I want to manage <br> <br>
    following .gitignore only commits these files/directories.  <br> <br>
    libvirt <br>
    compizconfig <br>
    bash_completion <br>
    environment <br>
    <br>
    =========beginngin of .gitignore========= <br>
    /*           # <br>
    /.*          # these 2 lines tells to ignore everything <br>
    # begin section managed by etckeeper (do not edit this section by hand) <br>
      # new and old versions of conffiles, stored by dpkg <br>
      *.dpkg-* <br>
      # new and old versions of conffiles, stored by ucf <br>
      *.ucf-* <br>
      # old versions of files <br>
      *.old <br>
      # mount(8) records system state here, no need to store these <br>
      blkid.tab <br>
      blkid.tab.old <br>
      # some other files in /etc that typically do not need to be tracked <br>
      nologin <br>
      ld.so.cache <br>
      prelink.cache <br>
      mtab <br>
      mtab.fuselock <br>
      .pwd.lock <br>
      *.LOCK <br>
      network/run <br>
      adjtime <br>
      lvm/cache <br>
      lvm/backup <br>
      lvm/archive <br>
      X11/xdm/authdir/authfiles/* <br>
      ntp.conf.dhcp <br>
      .initctl <br>
      webmin/fsdump/*.status <br>
      webmin/webmin/oscache <br>
      apparmor.d/cache/* <br>
      service/*/supervise/* <br>
      service/*/log/supervise/* <br>
      sv/*/supervise/* <br>
      sv/*/log/supervise/* <br>
      *.elc <br>
      *.pyc <br>
      *.pyo <br>
      init.d/.depend.* <br>
      openvpn/openvpn-status.log <br>
      cups/subscriptions.conf <br>
      cups/subscriptions.conf.O <br> <br>
      # editor temp files <br>
      *~ <br>
      .*.sw?  <br>
      .sw?  <br>
      \#*\# <br>
      DEADJOE <br>
      # end section managed by etckeeper <br>
      # explicitly point files/directories I want to manage <br>
      !/libvirt <br>
      !/compizconfig <br>
      !/bash_completion <br>
      !/environment <br>
      =========      end of .gitignore      ========= <br>
    when I installed etckeeper, it installed cron task to take a backup, <br>
    once every day, so it will be backedup everyday.  <br>
      $ cat /etc/cron.daily/etckeeper  <br>
      #!/bin/sh <br>
      set -e <br>
      if [ -x /usr/bin/etckeeper ] && [ -e /etc/etckeeper/etckeeper.conf ]; then <br>
      . /etc/etckeeper/etckeeper.conf <br>
      if [ "$AVOID_DAILY_AUTOCOMMITS" != "1" ]; then <br>
      # avoid autocommit if an install run is in progress <br>
      lockfile=/var/cache/etckeeper/packagelist.pre-install <br>
      if [ -e "$pe" ] && [ -n "$(find "$lockfile" -mtime +1)" ]; then <br>
      rm -f "$lockfile" # stale <br>
      fi <br>
      if [ ! -e "$lockfile" ]; then <br>
      AVOID_SPECIAL_FILE_WARNING=1 <br>
      export AVOID_SPECIAL_FILE_WARNING <br>
      if etckeeper unclean; then <br>
      etckeeper commit "daily autocommit" >/dev/null <br>
      fi <br>
      fi <br>
      fi <br>
      fi <br>
    I also wanted to push to github after commit, so I set it up.  <br>
    create a script <br>
    $ sudo vi /etc/etckeeper/commit.d/40git-push <br>
    =========beginngin of 40git-push========= <br>
      #!/bin/sh <br>
      set -e <br>
      if [ "$VCS" = git ] && [ -d .git ]; then <br>
        cd /etc/ <br>
        git push origin master <br>
      fi <br>
    ========= end of 40git-push========= <br>
    test <br>
      $ sudo vi /etc/environment <br>
      PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games" <br>
      EDITOR="/usr/bin/vim"   <-- add this line <br>
    commit <br>
    $ sudo etckeeper commit "test" <br>
    if it gets commited to your local repository and github, its success.  <br>
  <!-- Place this tag where you want the +1 button to render. -->
  <br>
  <div  class=g-plusone data-annotation=inline data-width=300>
  </div>
  <!-- Place this tag after the last +1 button tag. -->
  <script  type=text/javascript>
      (function() {
       var po = document.createElement('script'); 
       po.type = 'text/javascript'; 
       po.async = true;
       po.src = 'https://apis.google.com/js/plusone.js';
       var s = document.getElementsByTagName('script')[0];
       s.parentNode.insertBefore(po, s);
       })(); 
  </script>
</div>
